<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Turma - UNIGESTÃO</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/turmapy.css') }}">
  <script>
        const token = localStorage.getItem("token");
        if (!token) {
            window.location.href = "/login";
        }
  </script>
</head>
<body>
  <div class="container">

    <input type="radio" id="inicio" name="aba" checked>
    <input type="radio" id="atividades" name="aba">
    <input type="radio" id="trabalhos" name="aba">
    <input type="radio" id="notas" name="aba">
    <input type="radio" id="arquivos" name="aba">

    <aside class="menu">
      <div class="logo">
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo Unigestão">
        <h2>UNIGESTÃO</h2>
      </div>

      <h3>Algoritmos e Estrutura de Dados em Phyton</h3>

      <label for="inicio">Página Inicial</label>
      <label for="atividades">Atividades</label>
      <label for="trabalhos">Trabalhos</label>
      <label for="notas">Notas</label>
    </aside>

    <main class="conteudo">

      <section class="aba inicio">
        <h1>Bem-vindo à turma!</h1>
        <p>Aqui você encontrará todas as atividades, trabalhos e notas da disciplina.</p>
      </section>

      <section class="aba atividades">
        <h1>Atividades de Aula</h1>
        <p>Envie aqui suas atividades em formato PDF ou Word.</p>
        <div class="upload-container">
            <label for="file-upload" class="custom-file-upload">
                <div class="upload-icon">
                    <img src="{{ url_for('static', filename='img/input-turmas.png') }}" alt="upload icon">
                </div>
                <p>Anexe o arquivo desejado</p>
                <input type="file" id="file upload">
                <button type="submit" class="btn-enviar">Enviar</button>   
            </label>
        </div>
      </section>

      <section class="aba trabalhos">
        <h1>Trabalhos</h1>
        <p>Envie aqui os trabalhos passados em Aula</p>
        <div class="upload-container">
            <label for="file-upload" class="custom-file-upload">
                <div class="upload-icon">
                    <img src="{{ url_for('static', filename='img/input-turmas.png') }}" alt="upload icon">
                </div>
                <p>Anexe o arquivo desejado</p>
                <input type="file" id="file upload">
                <button type="submit" class="btn-enviar">Enviar</button>   
            </label>
        </div>
      </section>

      <section class="aba notas">
      <h1>Minhas Notas</h1>
      <table id="tabela-notas">
        <thead>
          <tr>
            <th>Atividade</th>
            <th>Nota</th>
          </tr>
        </thead>
        <tbody>
          <!-- Notas serão inseridas via JavaScript -->
        </tbody>
      </table>

      <p id="media-geral" style="margin-top:15px; font-weight:bold;"></p>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");
        if (!token) return;

        fetch("http://192.168.100.56:5000/api/notas/minhas", {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${token}`
          }
        })
        .then(response => response.json())
        .then(data => {
          const tabela = document.querySelector("#tabela-notas tbody");
          const mediaTexto = document.getElementById("media-geral");

          if (data.erro || data.mensagem) {
            tabela.innerHTML = `<tr><td colspan="2">${data.erro || data.mensagem}</td></tr>`;
            return;
          }

          tabela.innerHTML = ""; // limpar tabela

          // Lista de notas (simples)
          data.notas.forEach((nota, index) => {
            const row = `<tr><td>Atividade ${index + 1}</td><td>${nota.toFixed(2)}</td></tr>`;
            tabela.innerHTML += row;
          });

          // Exibir média
          mediaTexto.textContent = `Média Geral: ${data.media.toFixed(2)}`;
        })
        .catch(() => {
          document.querySelector("#tabela-notas tbody").innerHTML =
            "<tr><td colspan='2'>Erro ao carregar notas.</td></tr>";
        });
      });
    </script>
    </main>
  </div>
</body>
</html>
